


\usepackage{tikz}
\definecolor{shadecolor}{rgb}{0.9,0.9,0.9}
\definecolor{ocre}{RGB}{243,102,25}
\definecolor{examplecolor}{RGB}{218, 242, 193}
\definecolor{bigideacolor}{RGB}{255, 255, 86}
\definecolor{algorithmcolor}{RGB}{216, 231, 255}

%----------------------------------------------------------------------------------------
%	THEOREM STYLES
%----------------------------------------------------------------------------------------


\usepackage{amsmath,amsfonts,amssymb,amsthm} % For math equations, theorems, symbols, etc

\newcommand{\intoo}[2]{\mathopen{]}#1\,;#2\mathclose{[}}
\newcommand{\ud}{\mathop{\mathrm{{}d}}\mathopen{}}
\newcommand{\intff}[2]{\mathopen{[}#1\,;#2\mathclose{]}}
\newtheorem{notation}{Notation}[chapter]


%\newtheoremstyle{<name>}% name
%  {<dimen>}%              Space above
%  {<dimen>}%              Space below
%  {<font>}%               Body font
%  {}%                     Indent amount (empty = no indent, \parindent = para indent)
%  {<font>}%               Thm head font
%  {<punct>}%              Punctuation after thm head
%  {<dimen>}%              Space after thm head: " " = normal interword space; \newline = linebreak
%  {<spec>}%               Thm head spec (can be left empty, meaning `normal')

\makeatletter

% Boxed/framed environments
\newtheoremstyle{ocrenumbox}% % Theorem style name
{1em}% Space above was 0pt
{1ex}% Space below was 0pt
{\normalfont}% % Body font
{}% Indent amount
{\small\bf\sffamily\color{ocre}}% % Theorem head font
{\;}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily\color{ocre}\thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}}% Theorem text (e.g. Theorem 2.1)
\thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries\color{black}---\nobreakspace#3.}} % Optional theorem note
\renewcommand{\qedsymbol}{$\blacksquare$}% Optional qed square


\newtheoremstyle{bigideabox}% % Theorem style name
{1em}% Space above was 0pt
{1ex}% Space below was 0pt
{\normalfont}% % Body font
{}% Indent amount
{\Large\bf\sffamily}% % Theorem head font
{\;}% Punctuation after theorem head
{\newline}% Space after theorem head
{\Large \sffamily \faLightbulbO   \hspace{0.3em} \thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}}% Theorem text (e.g. Theorem 2.1)
\thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries\color{black}---\nobreakspace#3.}
\newline} % Optional theorem note


\newtheoremstyle{algorithmstyle} % Theorem style name
{0pt}% Space above
{0pt}% Space below
{\normalfont}% Body font
{}% Indent amount
{\small\bf\sffamily}% Theorem head font
{ }% Punctuation after theorem head
{\newline}% Space after theorem head
{\small\sffamily\thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}} % Theorem text (e.g. Theorem 2.1)
\thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries---\nobreakspace#3.}}% Optional theorem



\newtheoremstyle{blacknumex}% Theorem style name
{5pt}% Space above
{5pt}% Space below
{\normalfont}% Body font
{} % Indent amount
{\small\bf\sffamily}% Theorem head font
{\;}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily{\tiny\ensuremath{\blacksquare}}\nobreakspace\thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}}% Theorem text (e.g. Theorem 2.1)
\thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries---\nobreakspace#3.}}% Optional theorem note

\newtheoremstyle{blacknumbox} % Theorem style name
{0pt}% Space above
{0pt}% Space below
{\normalfont}% Body font
{}% Indent amount
{\small\bf\sffamily}% Theorem head font
{\;}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily\thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}}% Theorem text (e.g. Theorem 2.1)
\thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries---\nobreakspace#3.}}% Optional theorem note

% Non-boxed/non-framed environments
\newtheoremstyle{ocrenum}% % Theorem style name
{1ex}% Space above was 5pt
{1ex}% Space below was 5pt
{\normalfont}% % Body font
{}% Indent amount
{\small\bf\sffamily\color{ocre}}% % Theorem head font
{\;}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily\color{ocre}\thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}}% Theorem text (e.g. Theorem 2.1)
\thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries\color{black}---\nobreakspace#3.}} % Optional theorem note
\renewcommand{\qedsymbol}{$\blacksquare$}% Optional qed square


% Defines the theorem text style for each type of theorem to one of the three styles above
\newcounter{bigidea}

\newcounter{dummy}
\numberwithin{dummy}{chapter}

\theoremstyle{bigideabox}
\newtheorem{bigideaT}[bigidea]{Big Idea}

\theoremstyle{ocrenumbox}
\newtheorem{theoremeT}[dummy]{Theorem}
\newtheorem{problem}[dummy]{Problem}
\newtheorem{definitionT}[dummy]{Definition}
\newtheorem{remarkT}[dummy]{Remark}

\theoremstyle{algorithmstyle}
\newtheorem{algorithmT}[dummy]{Algorithm}

\theoremstyle{blacknumex}

\newtheorem{exampleT}[dummy]{Example}


\theoremstyle{blacknumbox}
\newtheorem{vocabulary}{Vocabulary}[chapter]
\newtheorem{corollaryT}[dummy]{Corollary}

\theoremstyle{ocrenum}
\newtheorem{exerciseT}{Exercise}[chapter]
\newtheorem{solvedexerciseT}{Solved Exercise}[chapter]
\newtheorem{proposition}[dummy]{Proposition}
\newtheorem{lemma}[dummy]{Lemma}  % added by Boaz


%----------------------------------------------------------------------------------------
%	DEFINITION OF COLORED BOXES
%----------------------------------------------------------------------------------------

\RequirePackage[framemethod=default]{mdframed} % Required for creating the theorem, definition, exercise and corollary boxes


%\usepackage{footnotehyper}
%\usepackage{footnote}

\def\temptexti{default value i}
\def\temptextii{default value ii}
\def\temptextiii{default value iii}

\newcounter{footnotetextcounter}

\newcommand{\tempfootnote}[1]{\stepcounter{footnotetextcounter}
 \footnotemark
 \global \expandafter\def\csname temptext\roman{footnotetextcounter}\endcsname{#1}
 }

\newenvironment{savenotes}
{\setcounter{footnotetextcounter}{0}
 \let\oldfootnote\footnote
 \let\footnote\tempfootnote
}
{\let\footnote\oldfootnote
 \spewnotes
 }

\newcommand{\spewnotes}{
\ifnum\value{footnotetextcounter}=1
\footnotetext{\temptexti}
\fi
\ifnum\value{footnotetextcounter}=2
\footnotetext{\temptexti}
\footnotetext{\temptextii}
\fi
\ifnum\value{footnotetextcounter}=3
\footnotetext{\temptexti}
\footnotetext{\temptextii}
\footnotetext{\temptextiii}
\fi
}

\newmdenv[
   leftmargin=\leftmargin,
   rightmargin=\leftmargin,
   topline=false,
   bottomline=false,
   skipabove=\topsep,
   skipbelow=\topsep
]{mdquote}

\iffalse

\let\origquote=\quote
\def\quote\mdquote
\def\endquote\endmdquote

\fi



% Theorem box
\newmdenv[
suppressfirstparskip=true,
skipabove=7pt,
skipbelow=7pt,
backgroundcolor=black!5,
linecolor=ocre,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
innerbottommargin=5pt]{tBox}



% Big idea box
\newmdenv[
suppressfirstparskip=true,
skipabove=7pt,
skipbelow=7pt,
backgroundcolor=bigideacolor,
linecolor=black,
topline = true,
leftline = true,
rightline = true,
bottomline = true,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
innerbottommargin=5pt]{biBox}



% Exercise box
\newmdenv[suppressfirstparskip=true,
skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
backgroundcolor=ocre!10,
linecolor=ocre,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
innerbottommargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt]{eBox}

% Example box
\newmdenv[suppressfirstparskip=true,
skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
backgroundcolor=examplecolor!10,
linecolor=ocre,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
innerbottommargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt]{exBox}


% Algorithm box
\newmdenv[suppressfirstparskip=false,
skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
backgroundcolor=algorithmcolor,
linecolor=black,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
innerbottommargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt,
nobreak=true]{algBox}


% Definition box
\newmdenv[suppressfirstparskip=true,
skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
linecolor=ocre,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=0pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt,
innerbottommargin=0pt]{dBox}

% Corollary box
\newmdenv[suppressfirstparskip=true,
skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
linecolor=gray,
backgroundcolor=black!5,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt,
innerbottommargin=5pt]{cBox}

% Creates an environment for each type of theorem and assigns it a theorem text style from the "Theorem Styles" section above and a colored box from above
\newenvironment{theorem}{\begin{savenotes}\begin{tBox}\begin{theoremeT}}{\end{theoremeT}\end{tBox}\end{savenotes}}


%\newenvironment{bigidea}{\begin{savenotes}\begin{biBox}\begin{bigideaT}}{\end{bigideaT}\end{biBox}\end{savenotes}}

%\newenvironment{bigidea}{\begin{savenotes}\begin{mybigideabox}\begin{bigideaT}}{\end{bigideaT}\end{mybigideabox}\end{savenotes}}


\newenvironment{bigidea}{\medskip \begin{shadowideablock}{\textwidth}\begin{bigideaT}}{\end{bigideaT}\end{shadowideablock} \medskip}




%\newenvironment{exercise}{\begin{savenotes}\begin{cBox}\begin{exerciseT}}{\hfill{\color{ocre}\tiny\ensuremath{\blacksquare}}\end{exerciseT}\end{cBox}\end{savenotes}}
\newenvironment{exercise}{\begin{exerciseT}}{\hfill{\color{ocre}\tiny\ensuremath{\blacksquare}}\end{exerciseT}}

\newenvironment{solvedexercise}{\begin{solvedexerciseT}}{\hfill{\color{ocre}\tiny\ensuremath{\blacksquare}}\end{solvedexerciseT}}

\newenvironment{solution}{\begin{dBox} \medskip \noindent {\small\bf\sffamily\color{ocre} Solution:}}{\hfill{\color{ocre}\tiny\ensuremath{\blacksquare}}\end{dBox}}



\newenvironment{definition}{\begin{savenotes}\begin{eBox}\begin{definitionT}}{\end{definitionT}\end{eBox}\end{savenotes}}
\newenvironment{example}{\begin{savenotes}\begin{exBox}\begin{exampleT}}{\end{exampleT}\end{exBox}\end{savenotes}}

\newenvironment{oldalgorithm}{\begin{savenotes}\begin{algBox}\begin{algorithmT}}{\end{algorithmT}\end{algBox}\end{savenotes}}

\newenvironment{algorithm}{\begin{savenotes}\begin{algBox}\begin{algorithmT}}{\end{algorithmT}\end{algBox}\end{savenotes}}


\newenvironment{corollary}{\begin{savenotes}\begin{cBox}\begin{corollaryT}}{\end{corollaryT}\end{cBox}\end{savenotes}}


%---------------------------
% SHADED QUOTE (added by Boaz)
%----------------------------
\definecolor{my-light-blue}{RGB}{192, 228 , 238}

\definecolor{my-light-yellow}{RGB}{247, 240, 195}

\definecolor{my-light-pink}{RGB}{239, 210, 239}

\definecolor{my-light-green}{RGB}{248, 255, 237}



\mdfdefinestyle{MyShadeQuoteStyle}{%
    leftmargin=15pt,
    rightmargin=15pt,
    backgroundcolor=my-light-green,
    linewidth=0pt,
    skipbelow=\topskip,
    skipabove=\topskip
}



\newenvironment{MyShadequote}[1][]{%
    \ignorespaces%
    \begin{mdframed}[style=MyShadeQuoteStyle,#1]%
}{%
    \end{mdframedfoot}%
    \ignorespacesafterend%
}%


\usepackage[most]{tcolorbox}
\definecolor{block-gray}{gray}{0.85}
\newtcolorbox{myshadedquotetwo}{colback=my-light-green,grow to right by=-10mm,grow to left by=-10mm, boxrule=0pt,boxsep=0pt,breakable}

% 192, 228 , 238
% 0.75, 0.89, 0.93

\newtcolorbox{mypausebox}{colback=my-light-blue,grow to right by=-3mm,grow to left by=-3mm, boxrule=0pt,boxsep=0pt,breakable}

\newtcolorbox{myremarkbox}{colback=my-light-yellow,grow to right by=-3mm,grow to left by=-3mm, boxrule=0pt,boxsep=0pt,breakable}


\newtcolorbox{myalgorithmbox}{colback=algorithmcolor,grow to right by=-3mm,grow to left by=-3mm, boxrule=0pt,boxsep=0pt,breakable}



\newtcolorbox{myrecapbox}{colback=my-light-pink,grow to right by=-3mm,grow to left by=-3mm, boxrule=0pt,boxsep=0pt,breakable}

\newtcolorbox{myobjectivesbox}{colback=my-light-pink,grow to right by=-3mm,grow to left by=-3mm, boxrule=0pt,boxsep=0pt,breakable}

\newtcolorbox{mybigideabox}{colback=bigideacolor,grow to right by=-3mm,grow to left by=-3mm, boxrule=0pt,boxsep=0pt,breakable}


\newenvironment{pausebox}{\begin{savenotes}\begin{mypausebox}}{\end{mypausebox}\end{savenotes}}
\newenvironment{remarkbox}{\begin{savenotes}\begin{myremarkbox}}{\end{myremarkbox}\end{savenotes}}
\newenvironment{recapbox}{\begin{savenotes}\begin{myrecapbox}}{\end{myrecapbox}\end{savenotes}}
\newenvironment{algorithmbox}{\begin{savenotes}\begin{myalgorithmbox}}{\end{myalgorithmbox}\end{savenotes}}

\newenvironment{objectivesbox}{\begin{savenotes}\begin{myobjectivesbox}}{\end{myobjectivesbox}\end{savenotes}}


%\renewenvironment{quote}%
%{\begin{snugshade}\begin{oldquote}}
%{\hfill\end{oldquote}\end{snugshade}}


\let\oldquote\quote
\let\oldendquote\endquote
%\def\quote{\begin{savenotes}\begin{mdframed}[style=MyShadeQuoteStyle] \begingroup \oldquote}
%\def\endquote{\hfill \oldendquote \endgroup \end{mdframed}\end{savenotes}}

\def\quote{\begin{savenotes}\begin{myshadedquotetwo}\begingroup \oldquote}
\def\endquote{\hfill \oldendquote \endgroup \end{myshadedquotetwo}\end{savenotes}}


%----------------------------------------------------------------------------------------
%	REMARK AND PAUSE ENVIRONMENTS
%----------------------------------------------------------------------------------------

\newenvironment{remark}[1][\unskip]{\begin{remarkbox}\par\vspace{10pt}\small % Vertical white space above the remark and smaller font size
\begin{list}{}{
\leftmargin=35pt % Indentation on the left
\rightmargin=25pt}\item\ignorespaces % Indentation on the right
\makebox[-2.5pt]{\begin{tikzpicture}[overlay]
\node[draw=ocre!60,line width=1pt,circle,fill=ocre!25,font=\sffamily\bfseries,inner sep=2pt,outer sep=0pt] at (-15pt,0pt){\textcolor{ocre}{R}};\end{tikzpicture}
} % Orange R in a circle
\advance\baselineskip -1pt
{\small\bf\sffamily\color{ocre}} \begin{remarkT}[#1]
}{\end{remarkT} \end{list}\vskip5pt \end{remarkbox}} % Tighter line spacing and white space after remark



\newenvironment{recap}{\begin{recapbox}\par\vspace{10pt}\small % Vertical white space above the remark and smaller font size
\begin{list}{}{
\leftmargin=35pt % Indentation on the left
\rightmargin=25pt}\item\ignorespaces % Indentation on the right
\makebox[-2.5pt]{\begin{tikzpicture}[overlay]
\node[draw=ocre!60,line width=1pt,circle,fill=ocre!25,font=\sffamily\bfseries,inner sep=2pt,outer sep=0pt] at (-15pt,0pt){\textcolor{blue}{$\checkmark$}};\end{tikzpicture}
} % Checkmark in a circle
\advance\baselineskip -1pt
{\small\bf\sffamily\color{ocre} Lecture Recap}
}{\end{list}\vskip5pt \end{recapbox}} % Tighter line spacing and white space after remark


\newenvironment{pause}[1][\unskip]{\begin{pausebox}\par\vspace{10pt}\small % Vertical white space above the remark and smaller font size
\begin{list}{}{
\leftmargin=35pt % Indentation on the left
\rightmargin=25pt}\item\ignorespaces % Indentation on the right
\makebox[-2.5pt]{\begin{tikzpicture}[overlay]
\node[draw=blue!60,line width=1pt,circle,fill=blue!25,font=\sffamily\bfseries,inner sep=2pt,outer sep=0pt] at (-15pt,0pt){\textcolor{white}{P}};\end{tikzpicture}
} % Orange R in a circle
\advance\baselineskip -1pt
{\small\bf\sffamily\color{ocre} #1}
}{\end{list}\vskip5pt \end{pausebox}} % Tighter line spacing and white space after remark



%-----------------------------------------
% Learning objectives box
% Code copied from 	A Course in Machine Learning by Hal Daum√© III
% http://ciml.info/
%------------------------------------------

\usepackage[absolute,overlay]{textpos}

%
% Boxed environment with semi-transparent shadow.
%
\newlength{\boxw}
\newlength{\boxh}
\newlength{\shadowsize}
\newlength{\boxroundness}
\newlength{\tmpa}
\newsavebox{\shadowblockbox}

\setlength{\shadowsize}{6pt}
\setlength{\boxroundness}{3pt}

\newenvironment{mycomment}{\begin{comment}}{\end{comment}}

\newenvironment{shadowblock}[1]%
{\begin{lrbox}{\shadowblockbox}\begin{minipage}{#1}}%
{\end{minipage}\end{lrbox}%
\settowidth{\boxw}{\usebox{\shadowblockbox}}%
\settodepth{\tmpa}{\usebox{\shadowblockbox}}%
\settoheight{\boxh}{\usebox{\shadowblockbox}}%
\addtolength{\boxh}{\tmpa}%
\begin{tikzpicture}
    \addtolength{\boxw}{\boxroundness * 2}
    \addtolength{\boxh}{\boxroundness * 2}

    \foreach \x in {0,.05,...,1}
    {
        \setlength{\tmpa}{\shadowsize * \real{\x}}
        \fill[xshift=\shadowsize - 1pt,yshift=-\shadowsize + 1pt,
                black,opacity=.04,rounded corners=\boxroundness]
            (\tmpa, \tmpa) rectangle +(\boxw - \tmpa - \tmpa,
                \boxh - \tmpa - \tmpa);
    }

    \filldraw[fill=my-light-pink, draw=black!50, rounded corners=\boxroundness]
        (0, 0) rectangle (\boxw, \boxh);
    \draw node[xshift=\boxroundness,yshift=\boxroundness,
        inner sep=1pt,outer sep=1pt,anchor=south west]
             (0,0) {\usebox{\shadowblockbox}};
\end{tikzpicture}}


\newenvironment{shadowideablock}[1]%
{\begin{lrbox}{\shadowblockbox}\begin{minipage}{#1}}%
{\end{minipage}\end{lrbox}%
\settowidth{\boxw}{\usebox{\shadowblockbox}}%
\settodepth{\tmpa}{\usebox{\shadowblockbox}}%
\settoheight{\boxh}{\usebox{\shadowblockbox}}%
\addtolength{\boxh}{\tmpa}%
\begin{tikzpicture}
    \addtolength{\boxw}{\boxroundness * 2}
    \addtolength{\boxh}{\boxroundness * 2}

    \foreach \x in {0,.05,...,1}
    {
        \setlength{\tmpa}{\shadowsize * \real{\x}}
        \fill[xshift=\shadowsize - 1pt,yshift=-\shadowsize + 1pt,
                black,opacity=.04,rounded corners=\boxroundness]
            (\tmpa, \tmpa) rectangle +(\boxw - \tmpa - \tmpa,
                \boxh - \tmpa - \tmpa);
    }

    \filldraw[fill=bigideacolor, draw=black!50, rounded corners=\boxroundness]
        (0, 0) rectangle (\boxw, \boxh);
    \draw node[xshift=\boxroundness,yshift=\boxroundness,
        inner sep=1pt,outer sep=1pt,anchor=south west]
             (0,0) {\usebox{\shadowblockbox}};
\end{tikzpicture}}


\newsavebox{\halobjectivesbox}
\newlength{\objectivesheight}
\newenvironment{objectives}
  {\begin{lrbox}{\halobjectivesbox}\begin{minipage}{2.5in}\vspace{2pt}{\bf Learning Objectives:}\begin{footnotesize}}
  {\end{footnotesize}\end{minipage}\end{lrbox}\begin{textblock}{2.5}(10.7,0.7)\begin{shadowblock}{2.5in}\usebox{\halobjectivesbox}\end{shadowblock}\end{textblock}\settoheight{\objectivesheight}{\usebox{\halobjectivesbox}}}

% 10.2, 2.5


\makeatother

\newenvironment{proofidea}{\medskip \noindent {\small\bf\sffamily\color{ocre} Proof Idea:}}{{\color{ocre}\ensuremath{\star}}\medskip\noindent}



\usepackage[capitalise,nameinlink]{cleveref}
\crefname{lemma}{Lemma}{Lemmas}
\crefname{definition}{Definition}{Definitions}
\crefname{problem}{Problem}{Problems}
\crefname{exercise}{Exercise}{Exercises}
\crefname{example}{Example}{Examples}
\crefname{remark}{Remark}{Remarks}
\crefname{solvedexercise}{Solved Exercise}{Solved Exercises}
\crefname{bigidea}{Big Idea}{Big Ideas}
\crefname{algorithm}{Algorithm}{Algorithms}


